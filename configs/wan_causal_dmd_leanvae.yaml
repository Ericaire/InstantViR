model_name: wan
generator_name: causal_wan

# You can replace this with the ODE fine-tuned checkpoint after Step 2 finishes
# generator_ckpt: "./checkpoints/ode/model.pt"
# generator_ckpt: "./outputs/wan_causal_ode_leanvae/2025-11-14-07-12-20.585851_seed3207841/checkpoint_model_003000/model.pt"

# generator_ckpt: "./checkpoints/autoregressive_checkpoint/model.pt"
generator_ckpt: "./outputs/wan_causal_dmd_leanvae/2025-12-09-04-55-09.617304_seed1217857/checkpoint_model_002800/model.pt"

generator_fsdp_wrap_strategy: size
real_score_fsdp_wrap_strategy: size
fake_score_fsdp_wrap_strategy: size
text_encoder_fsdp_wrap_strategy: size

generator_grad:
  model: true
real_score_grad:
  model: false
fake_score_grad:
  model: true

denoising_step_list:
- 1000
- 757
- 522
- 0
num_train_timestep: 1000
timestep_shift: 8.0
real_guidance_scale: 3.5

generator_task: causal_video
real_task_type: bidirectional_video
fake_task_type: bidirectional_video
denoising_loss_type: flow

mixed_precision: true
seed: 0

wandb_host: WANDB_HOST
wandb_key: WANDB_KEY
wandb_entity: tyin
wandb_project: causvid
wandb_name: wan_causal_dmd_leanvae

sharding_strategy: hybrid_full
# lr: 1.0e-05
lr: 1.0e-04
beta1: 0.9
beta2: 0.999

# Dataset for DMD (latent LMDB of clean videos)
# Use the LeanVAE-converted MixKit LMDB (WAN latent → pixel → LeanVAE latent)
data_path: data/mixkit_latents_leanvae_lmdb
batch_size: 4
log_iters: 200

negative_prompt: '色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走'

dfake_gen_update_ratio: 5
image_or_video_shape:
- 1
- 21
- 16
- 60
- 104

output_path: ./outputs/wan_causal_dmd_leanvae
distillation_loss: dmd
gradient_checkpointing: true
backward_simulation: false
num_frame_per_block: 3
warp_denoising_step: false

# LeanVAE settings + latent conversion
vae_type: leanvae
leanvae_ckpt_path: LeanVAE-master/LeanVAE-16ch_ckpt/LeanVAE-dim16.ckpt
disable_latent_conversion: false

# GT consistency settings
use_gt_consistency: true
# 在像素空间做 GT 监督（LeanVAE decode 后对比 GT 像素）
gt_consistency_space: pixel
# 像素 GT loss 权重（可在 0.5~2.0 间调节）
# gt_consistency_weight: 1.0
gt_consistency_weight: 1.0

# Warmup settings
# 为了让像素 GT 先主导一段时间，可适当拉高 warmup；若想立刻启用 DMD，可改回 0
dmd_warmup_steps: 10000
# dmd_warmup_steps: 0

